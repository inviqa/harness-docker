{% set blocks  = 'application/overlay/_twig/Jenkinsfile/' %}
{% extends blocks ~ 'base.twig' %}

{#
{% block agent %}
    agent {
        docker {
            label 'linux-amd64'
            alwaysPull true
            image 'quay.io/inviqa_images/workspace:latest'
            args '--group-add docker --entrypoint "" --volume /var/run/docker.sock:/var/run/docker.sock --volume "$HOME/.my127:/root/.my127"'
        }
    }
{% endblock %}

{% block stages %}
        stage('Build, Test') {
            when {
                anyOf {
                    triggeredBy 'TimerTrigger'
                    allOf {
                        not { branch 'main' }
                    }
                }
            }
            stages {
                {% include blocks ~ 'stages-build-test.twig' %}
            }
        }
        stage('Publish, Release') {
            when {
                not { triggeredBy 'TimerTrigger' }
                anyOf {
                    branch 'develop'
                    branch 'main'
                }
            }
            stages {
                {% include blocks ~ 'stages-publish-release.twig' %}
            }
        }
{% endblock %}
#}
